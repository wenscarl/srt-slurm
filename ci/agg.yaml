# Router benchmark - Aggregated mode with Qwen 32B
#
# For sglang-router (if using frontend.use_sglang_router: true):
#   Policies: random | round_robin | cache_aware | power_of_two | bucket
#   sglang_router_args:
#     policy: cache_aware          # prefix-aware load balancing
#     cache-threshold: 0.5         # cache hit threshold for routing decisions
#     balance-abs-threshold: 32    # absolute load difference before rebalancing
#     balance-rel-threshold: 1.0   # relative load ratio before rebalancing

name: "router-bench-agg-qwen32b"

model:
  path: "qwen32b"  # alias - configure in srtslurm.yaml
  container: "latest"
  precision: "fp8"

resources:
  gpu_type: "h100"
  agg_nodes: 2
  agg_workers: 2
  gpus_per_node: 8

frontend:
  dynamo_frontend_args:
    router-mode: kv
    router-reset-states: true

backend:
  sglang_config:
    # use flashhattn 3 for attn backend
    aggregated:
      served-model-name: "Qwen/Qwen3-32B"
      model-path: "/model/"
      trust-remote-code: true
      tensor-parallel-size: 8
      mem-fraction-static: 0.90

benchmark:
  type: "router"

